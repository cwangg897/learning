#### 영속성 컨텍스트
```
논리적인개념이다
엔티티 매니저를 통해 영속성 컨텍스트에 접근가능하다.
영속 상태는 영소성컨텍스트에 객체가 들어가진 상태이다
영속상태에 디비 쿼리가 날아가는게 아니라 트랜잭션 커밋할때 날아간다
```

#### 영속성 컨텍스트 장점
- 1차 캐시
- 동일성 보장 : 자바컬렉션에서 같은거 가져오면 == 과 같이 영속성 컨텍스트에서도 작동한다
- 트랜잭션을 지원하는 쓰기 지연 : 버퍼 flush 혹은 커밋 할때 쿼리가 날아감  hibernate_batch_size
- 변경 감지 : update쿼리없이 변경가능, 커밋 시점에 스냅샷을 비교하고 쿼리를 쿼리젖아소로 넣고 DB에 반영
- 지연 로딩 (즉시로딩의 반대) : 필요할때 객체를 가져올 수 있음

#### 영속성 컨텍스트 정리 
영속성 컨텍스트는 1차캐시(엔티티 스냅샷)와 쓰기지연 SQL저장소로 구성되어있다 
![image](https://github.com/cwangg897/learning/assets/79621675/288d0f6b-38c9-4434-b262-a007056c7024)


### 플러시
```
영속성 컨텍스트의 변경내용을 데이터베이스에 반영
커밋될때 플러시가 일어나느데 일부러 할 수 있다.
영속성 컨텍스트 SQL저장소에있는 쿼리를 DB에 날아간다
플러시한다고해서 커밋되는게 아님 또한 1차 캐시 지워지는것도 아님 
```

#### 영속성 컨텍스트 플러시 발생하는 경우
- 직접 호출
- 트랜잭션 커밋 : 플러시는 커밋전에 동작하는거임
- JPQL쿼리 실행 - 플러시 자동 호출

#### JPQL하면 플러시 자동호출되는 이유
JPQL은 기본모드가 무조건 플러시가 호출됨

#### 준영속 상태로 만드는 방법
- em.detach 특정 엔티티만 준영속
- em.clear() 영속성 컨텍스트를 다 비워버림 초기화
- em.close() 영속성 컨텍스트 종료 사라져버림
